<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Automated Seach of Sentences</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <link rel='stylesheet' type='text/css' media='screen' href='main.css'>
    <script>

        const getFirstRowElement = async(firstRow) => {
            const tdsFirstEvenRow = firstRow.getElementsByTagName('td');
            const word = await tdsFirstEvenRow[0].firstChild.innerText;
            const sinonimo = await tdsFirstEvenRow[1].innerText;
            const childsThirdTd = tdsFirstEvenRow[2].childNodes;
            const significado = await childsThirdTd[0].nodeValue;

            return {word, sinonimo, significado};
        }

        const getSentences = async (word) => {
            const url = 'https://www.wordreference.com/enpt/' + word;
            const response = await fetch(url);
            const text = await response.text();
            const html = new DOMParser().parseFromString(text, "text/html");
            
            const tableWRD = html.getElementsByClassName('WRD')[0]; // what we want is in this table
            let rows = await tableWRD.getElementsByTagName('tr');

            let i = 0;
            while(rows[i].className != 'even') i++;


            let wordObj = await getFirstRowElement(rows[i]); 

            while(rows[i].getElementsByClassName('FrEx').length == 0) i++;
            wordObj.sentence = rows[i].getElementsByClassName('FrEx')[0].innerText.replace(wordObj.word, `<b>${wordObj.word}</b>`);


            const tooltip = html.querySelectorAll('.tooltip.pronWidget');
            // console.log(tooltip);

            for(let j = 0; j < tooltip.length; j++) {
                if(tooltip[j].childNodes == undefined) continue;
                if(tooltip[j].childNodes[0].nodeValue == 'US:') {
                    wordObj.pronounce = tooltip[j+1].childNodes[1].nodeValue
                }
            }

            return wordObj;
            // console.log( wordObj );

        }
        
        const loadingPage = () => document.getElementById('body').innerHTML = 'Loading...';

        const getListOfWords = async () => {
            const text = await document.getElementById('words');
            return text.value.split('\n');
        }

        const showResult = (arr, err) => {
            let htmlResponse = '<h1>Palavras bem sucedidas</h1>';
            console.log(arr);
            arr.forEach(element => {
                htmlResponse += element.sentence + '</br>' ;
                htmlResponse += '<b>' + element.word + ' ' + element.pronounce + '</b></br>';
                htmlResponse += element.sinonimo + ' ' + element.significado + '</br>'
                htmlResponse += '</br>'
            });
            htmlResponse += '<h1>Palavras mal sucedidas</h1>';
            err.forEach(element => {
                htmlResponse += element + '</br>'
            });
            document.getElementById('body').innerHTML = htmlResponse;
        }

        const main = async () => {
            const words = await getListOfWords();
            loadingPage();
                
            let arr = [];
            let err = [];
            for(let i = 0; i < words.length; i++) {
                try {
                    arr.push(await getSentences(words[i]));
                } catch {
                    err.push(words[i]);
                }
            }

            showResult(arr, err);
        }

    </script>
</head>
<body id="body">
    <p>Put the words down here and press start do search to generate anki cards</p>
    <textarea id="words"></textarea>
    <p></p>
    <button id="start" onclick="main()">Start!</button>
</body>
</html>


<!-- EXEMPLO DA PALAVRAS
pleasent
shivered
nicely
settled
portrait
pluzzed
along
altogether
absence
amusing
pretence
sympathetic
stared
rid
suntanned
pumped
concerning
them
heiress
cousin
odd
guilty
nightmare
grow
chauffeur
moustache
annoyed
whispered
sharp
ought
waves
pale
foolish
wreckage
dusty
roll
fortunate
though
pale
spare
quiet
ascertain
motorway
hostess
lying
mean
spring
swing
branch
tied
relief
unaware
laid
tall
slim
shouts
uncle
addict
light-hearted
doubt
hush
glance
attractive looking
fairly
settled
nodded
inquiringly
rubbish
bought
seemed
-->

<!--
suntanned
inquires
madness
glasses
chattered
staged
moody
bothered
rescue
thick
suffers
dared
settled
disguise
kindly
groans
barmaid
eagerly
nightgown
farther
corner
grin
bushes
at once
-->